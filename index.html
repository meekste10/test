<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Holland Homes — Contact Dashboard</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee; --card:#0b1022; --chip:#1f2937; }
    html,body{margin:0;background:linear-gradient(180deg,#0b1022,#0f172a 35%,#0b1022);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
    h1{font-size:clamp(20px,3vw,28px);margin:0;letter-spacing:.3px}
    .panel{background:var(--panel);border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 30px rgba(0,0,0,.35);border-radius:16px;padding:16px}
    .controls{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:12px;align-items:end}
    @media (max-width:900px){.controls{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.controls{grid-template-columns:1fr}}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"],select{width:100%;padding:10px 12px;border-radius:10px;outline:none;border:1px solid rgba(255,255,255,.08);background:#0c1428;color:var(--text)}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0c1428;color:var(--text);cursor:pointer}
    .btn:hover{border-color:var(--accent)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{background:var(--chip);color:var(--text);border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer;user-select:none}
    .summary{display:flex;gap:12px;flex-wrap:wrap}
    .pill{background:#0c1428;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:12px;font-size:12px;color:var(--muted)}
    .pill strong{color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;display:flex;gap:12px;align-items:flex-start}
    .avatar{width:48px;height:48px;border-radius:12px;background:linear-gradient(180deg,#1f2937,#0b1022);display:grid;place-items:center;color:#cbd5e1;font-weight:700}
    .card h3{margin:0 0 4px 0;font-size:16px}
    .meta{color:var(--muted);font-size:12px}
    .meta span{display:inline-block;margin-right:10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:8px}
    .tag{background:#0c1428;color:var(--text);border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px;font-size:11px}
    .contact a{color:var(--accent);text-decoration:none}
    .muted{color:var(--muted)}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .footer{text-align:center;color:var(--muted);font-size:12px;padding:18px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Holland Homes — Contact Dashboard</h1>
      <div class="toolbar"><button id="exportBtn" class="btn">Export CSV</button></div>
    </header>
    <section class="panel" style="margin-top:14px;">
      <div class="controls">
        <div>
          <label for="q">Search (name, email, dept, region, address…)</label>
          <input id="q" type="text" placeholder="Type to search…" />
        </div>
        <div>
          <label for="dept">Filter — Department</label>
          <select id="dept" multiple size="4"></select>
        </div>
        <div>
          <label for="region">Filter — Region</label>
          <select id="region" multiple size="4"></select>
        </div>
        <div>
          <label for="sort">Sort</label>
          <select id="sort">
            <option value="last">Last Name (A→Z)</option>
            <option value="first">First Name (A→Z)</option>
            <option value="dept">Department</option>
            <option value="region">Region</option>
          </select>
        </div>
      </div>
      <div class="chips" id="quickChips"></div>
      <div class="summary" id="summary" style="margin-top:12px;"></div>
    </section>
    <section class="panel" style="margin-top:14px;">
      <div id="results" class="grid"></div>
      <div id="empty" class="muted" style="display:none; padding: 20px; text-align:center;">No contacts match your filters.</div>
    </section>
    <div class="footer">Data source: HH_Contacts_2025.csv</div>
  </div>

  <script>
    // CHANGE THIS LINE to match where you upload the CSV in SharePoint
    const CSV_URL = "./HH_Contacts_2025.csv";
    function parseCSV(text) {
      const rows = []; let i = 0, cur = [], val = '', inQuotes = false;
      function pushVal(){ cur.push(val); val=''; }
      function pushRow(){ rows.push(cur); cur=[]; }
      while (i < text.length) {
        const c = text[i];
        if (inQuotes) {
          if (c === '"') { if (text[i+1] === '"') { val += '"'; i++; } else { inQuotes = false; } }
          else { val += c; }
        } else {
          if (c === '"') { inQuotes = true; }
          else if (c === ',') { pushVal(); }
          else if (c === '\n' || c === '\r') { if (val!=='' || cur.length>0) { pushVal(); pushRow(); } while (text[i+1]==='\r' || text[i+1]==='\n') i++; }
          else { val += c; }
        }
        i++;
      }
      if (val!=='' || cur.length>0) { pushVal(); pushRow(); }
      if (rows.length === 0) return [];
      const headers = rows.shift().map(h=>h.trim());
      return rows.filter(r=>r.some(cell=>String(cell).trim()!==''))
                 .map(r => Object.fromEntries(headers.map((h,idx)=>[h, (r[idx]??'').toString().trim()])));
    }
    function safe(v){ return (v===undefined||v===null)?'':String(v).trim(); }
    function formatPhone(s){ s=safe(s).replace(/[^0-9]/g,''); if(!s)return''; if(s.length===11&&s.startsWith('1'))s=s.slice(1); if(s.length===10)return '('+s.slice(0,3)+') '+s.slice(3,6)+'-'+s.slice(6); return s; }
    function initials(f,l){ f=safe(f).charAt(0).toUpperCase(); l=safe(l).charAt(0).toUpperCase(); return (f||'?')+(l||''); }
    function toCSV(rows){ if(!rows.length)return''; const headers=Object.keys(rows[0]); const esc=v => '"'+String(v).replace(/"/g,'""')+'"'; return [headers.join(','),...rows.map(r=>headers.map(h=>esc(r[h]??'')).join(','))].join('\n'); }

    const COLS = { first:['First Name','First','FName'], last:['Last Name','Last','LName'], email:['Email Address','Email','E-mail'], work:['Work Number','Work Phone','Phone Work'], personal:['Personal Number','Mobile','Cell','Personal Phone'], dept:['Department','Dept'], address:['Address','Location'], region:['Region','Office'], mh1:['Model Home'], mh1p:['Model Home Phone'], mh2:['Model Home 2'], mh2p:['Model Home 2 Phone'] };
    function pick(obj, keys){ for (const k of keys){ for (const key in obj){ if (key.toLowerCase() === k.toLowerCase()) return obj[key]; } } return ''; }
    function transform(raw){ return raw.map(r=>({ first:safe(pick(r,COLS.first)), last:safe(pick(r,COLS.last)), email:safe(pick(r,COLS.email)), work:formatPhone(pick(r,COLS.work)), personal:formatPhone(pick(r,COLS.personal)), dept:safe(pick(r,COLS.dept))||'—', address:safe(pick(r,COLS.address)), region:safe(pick(r,COLS.region))||'—', mh1:safe(pick(r,COLS.mh1)), mh1p:formatPhone(pick(r,COLS.mh1p)), mh2:safe(pick(r,COLS.mh2)), mh2p:formatPhone(pick(r,COLS.mh2p)) })); }

    function setOptions(sel, values){ sel.innerHTML=''; const uniq=[...new Set(values.filter(Boolean))].sort((a,b)=>a.localeCompare(b)); for (const v of uniq){ const opt=document.createElement('option'); opt.value=v; opt.textContent=v; sel.appendChild(opt);} }
    function selectedValues(sel){ return Array.from(sel.selectedOptions).map(o=>o.value); }
    function makeChip(label, fn){ const el=document.createElement('div'); el.className='chip'; el.textContent=label; el.onclick=fn; return el; }

    function renderSummary(rows){ const wrap=document.getElementById('summary'); wrap.innerHTML=''; const total=document.createElement('div'); total.className='pill'; total.innerHTML = '<strong>'+rows.length+'</strong> contacts'; wrap.appendChild(total); const byDept={}; for (const r of rows) byDept[r.dept]=(byDept[r.dept]||0)+1; for (const k in byDept){ const pill=document.createElement('div'); pill.className='pill'; pill.innerHTML = '<strong>'+byDept[k]+'</strong> in '+k; wrap.appendChild(pill);} }
    function renderGrid(rows){ const grid=document.getElementById('results'); const empty=document.getElementById('empty'); grid.innerHTML=''; if (!rows.length){ empty.style.display='block'; return; } else { empty.style.display='none'; } for (const r of rows){ const card=document.createElement('div'); card.className='card'; const avatar=document.createElement('div'); avatar.className='avatar'; avatar.textContent=initials(r.first,r.last); const body=document.createElement('div'); const h3=document.createElement('h3'); h3.textContent=(r.first+' '+r.last).trim(); const meta=document.createElement('div'); meta.className='meta'; meta.innerHTML='<span>'+r.dept+'</span><span>•</span><span>'+r.region+'</span>'; const row1=document.createElement('div'); row1.className='row contact'; const email=r.email?'<a href="mailto:'+r.email+'">'+r.email+'</a>':'<span class="muted">No email</span>'; const work=r.work?'<a href="tel:'+r.work.replace(/\\D/g,'')+'">Work '+r.work+'</a>':''; const personal=r.personal?'<a href="tel:'+r.personal.replace(/\\D/g,'')+'">Mobile '+r.personal+'</a>':''; row1.innerHTML=[email,work,personal].filter(Boolean).join(' &nbsp;•&nbsp; '); const row2=document.createElement('div'); row2.className='row'; if(r.address){ const t=document.createElement('div'); t.className='tag'; t.textContent=r.address; row2.appendChild(t);} if(r.mh1){ const t=document.createElement('div'); t.className='tag'; t.textContent='Model Home: '+r.mh1+(r.mh1p?' ('+r.mh1p+')':''); row2.appendChild(t);} if(r.mh2){ const t=document.createElement('div'); t.className='tag'; t.textContent='Model Home 2: '+r.mh2+(r.mh2p?' ('+r.mh2p+')':''); row2.appendChild(t);} body.appendChild(h3); body.appendChild(meta); body.appendChild(row1); body.appendChild(row2); card.appendChild(avatar); card.appendChild(body); grid.appendChild(card);} }
    function buildQuickChips(departments, regions, apply){ const host=document.getElementById('quickChips'); host.innerHTML=''; const all=makeChip('All',()=>{document.getElementById('dept').selectedIndex=-1; document.getElementById('region').selectedIndex=-1; apply();}); host.appendChild(all); [...new Set(departments)].sort((a,b)=>a.localeCompare(b)).forEach(d=>host.appendChild(makeChip(d,()=>{ const sel=document.getElementById('dept'); [...sel.options].forEach(o=>o.selected=(o.value===d)); apply(); }))); [...new Set(regions)].sort((a,b)=>a.localeCompare(b)).forEach(r=>host.appendChild(makeChip(r,()=>{ const sel=document.getElementById('region'); [...sel.options].forEach(o=>o.selected=(o.value===r)); apply(); }))); }
    function attachExport(filtered){ document.getElementById('exportBtn').onclick=()=>{ const csv=toCSV(filtered.map(x=>({'First Name':x.first,'Last Name':x.last,'Email Address':x.email,'Work Number':x.work,'Personal Number':x.personal,'Department':x.dept,'Address':x.address,'Region':x.region,'Model Home':x.mh1,'Model Home Phone':x.mh1p,'Model Home 2':x.mh2,'Model Home 2 Phone':x.mh2p}))); const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url;a.download='contacts_filtered.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }; }
    function setup(raw){ const data=transform(raw); const q=document.getElementById('q'); const deptSel=document.getElementById('dept'); const regionSel=document.getElementById('region'); const sortSel=document.getElementById('sort'); setOptions(deptSel,data.map(d=>d.dept)); setOptions(regionSel,data.map(d=>d.region)); buildQuickChips(data.map(d=>d.dept),data.map(d=>d.region),apply); function apply(){ const term=q.value.trim().toLowerCase(); const depts=new Set(selectedValues(deptSel)); const regions=new Set(selectedValues(regionSel)); let rows=data.filter(r=>{ const hay=(r.first+' '+r.last+' '+r.email+' '+r.dept+' '+r.region+' '+r.address+' '+r.mh1+' '+r.mh2).toLowerCase(); const passTerm=term===''||hay.includes(term); const passDept=depts.size===0||depts.has(r.dept); const passRegion=regions.size===0||regions.has(r.region); return passTerm&&passDept&&passRegion; }); const sorter=sortSel.value; rows.sort((a,b)=>({ last:a.last.localeCompare(b.last), first:a.first.localeCompare(b.first), dept:a.dept.localeCompare(b.dept), region:a.region.localeCompare(b.region) }[sorter])); renderSummary(rows); renderGrid(rows); attachExport(rows);} q.addEventListener('input',apply); deptSel.addEventListener('change',apply); regionSel.addEventListener('change',apply); sortSel.addEventListener('change',apply); apply(); }
    async function load(){ try{ const res=await fetch(CSV_URL,{cache:'no-cache'}); if(!res.ok) throw new Error('Fetch failed'); const csvText=await res.text(); const raw=parseCSV(csvText); setup(raw); } catch(err){ console.error('CSV load/parse error:',err); document.getElementById('results').innerHTML='<div class="muted">Unable to load CSV. Check CSV_URL.</div>'; } }
    load();
  </script>
</body>
</html>
